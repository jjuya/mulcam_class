<%@page import="java.net.URLEncoder"%>
<%@page import="java.sql.*"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    
<%
	String user_id = request.getParameter("user_id");
	String user_pw = request.getParameter("user_pw");
	String user_name = null;

	Connection conn = null;
	PreparedStatement pstmt = null;
	Statement stmt = null;
	ResultSet rs = null;
	
	StringBuffer sql = new StringBuffer();
	sql.append(" SELECT user_name");
	sql.append(" FROM t_mem");
	sql.append(" WHERE user_id = ?");
	sql.append("AND user_pw=?");
	
	try {
		Class.forName("oracle.jdbc.OracleDriver");	
		
		conn = DriverManager.getConnection("jdbc:oracle:thin:@localhost:1521:xe", "bigdata", "bigdata");
		pstmt = conn.prepareStatement(sql.toString());
		pstmt.setString(1, user_id);
		pstmt.setString(2, user_pw);
		rs = pstmt.executeQuery();
				
		if(rs.next()) {
			user_name = rs.getString("user_name");
			
			return user_name;
		} else {
			throw new LoginFailException("아이디 혹은 비밀번호가 잘못되었습니다.", userInfo);
		} //end if
		
	} finally {
		if(rs != null) try{rs.close();} catch (Exception e) {}
		if(pstmt != null) try{pstmt.close();} catch (Exception e) {}
		if(conn != null) try{conn.close();} catch (Exception e) {}
	} //end try-finally
%>
    
 <%
 	String user_id = request.getParameter("user_id");
 	String user_name = request.getParameter("user_name");
 	int user_level = Integer.parseInt(request.getParameter("user_level"));
 	
 	Cookie c1 = new Cookie("user_id", URLEncoder.encode(user_id, "UTF-8"));
 	c1.setMaxAge(60);
 	response.addCookie(c1);
 	
 	Cookie c2 = new Cookie("user_name", URLEncoder.encode(user_name, "UTF-8"));
 	c2.setMaxAge(60);
 	response.addCookie(c2);
 	
 	Cookie c3 = new Cookie("user_level", URLEncoder.encode(user_level + "", "UTF-8"));
 	c3.setMaxAge(60);
 	response.addCookie(c3); 	
 	
 	response.sendRedirect("cookie_status.jsp");
 %>
 
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="shortcut icon" href="../../favicon.ico" />
</head>
<body>

</body>
</html>